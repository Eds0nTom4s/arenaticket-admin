================================================================================
  GUIA DE IMPLEMENTA√á√ÉO - SISTEMA DE RESEND E RASTREAMENTO DE NOTIFICA√á√ïES
  Painel Administrativo ArenaTicket
  Data: 14 de dezembro de 2025
  Vers√£o: 1.0
================================================================================

√çNDICE
------
1. VIS√ÉO GERAL
2. ARQUITETURA DA SOLU√á√ÉO
3. ENDPOINTS DA API BACKEND
4. MODELO DE DADOS
5. IMPLEMENTA√á√ÉO FRONTEND
6. INDICADORES VISUAIS
7. MODAL DE DETALHES DO PEDIDO
8. SISTEMA DE RESEND
9. FLUXO DE TRABALHO
10. CASOS DE USO
11. CONSIDERA√á√ïES DE SEGURAN√áA
12. TESTES E VALIDA√á√ÉO


================================================================================
1. VIS√ÉO GERAL
================================================================================

OBJETIVO:
Implementar sistema visual para identificar pedidos com problemas de entrega
de SMS e fornecer funcionalidade de reenvio de c√≥digos com hist√≥rico completo
de tentativas de notifica√ß√£o.

FUNCIONALIDADES PRINCIPAIS:
- Indicador visual de pedidos com notifica√ß√µes falhadas
- Hist√≥rico completo de notifica√ß√µes (sucesso/falha) por pedido
- Bot√£o de resend integrado no modal de detalhes
- Dashboard de sa√∫de do sistema SMS
- Auditoria de todas as opera√ß√µes de resend

BENEF√çCIOS:
- Identifica√ß√£o r√°pida de pedidos problem√°ticos
- Resolu√ß√£o proativa de falhas de comunica√ß√£o
- Visibilidade completa do hist√≥rico de notifica√ß√µes
- Redu√ß√£o de chamados de suporte


================================================================================
2. ARQUITETURA DA SOLU√á√ÉO
================================================================================

COMPONENTES BACKEND (J√Å IMPLEMENTADOS):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SmsHealthMonitor                                             ‚îÇ
‚îÇ - Rastreia sa√∫de do sistema SMS                             ‚îÇ
‚îÇ - Contadores: consecutiveFailures, totalFailures, success   ‚îÇ
‚îÇ - Alertas autom√°ticos ap√≥s threshold                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ TelcoSmsNotificationProvider                                 ‚îÇ
‚îÇ - Integrado com SmsHealthMonitor                            ‚îÇ
‚îÇ - Registra recordSuccess() ou recordFailure(reason)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PedidoService                                                ‚îÇ
‚îÇ - reenviarCodigosBilhetes(UUID pedidoId)                    ‚îÇ
‚îÇ - Valida PAID, telefone, bilhetes                           ‚îÇ
‚îÇ - Reenvia SMS com contexto completo                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

COMPONENTES FRONTEND (A IMPLEMENTAR):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PedidosTable                                                 ‚îÇ
‚îÇ - Lista pedidos com indicadores visuais                     ‚îÇ
‚îÇ - Cor diferenciada para pedidos com notifica√ß√µes falhadas   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PedidoDetailsModal                                           ‚îÇ
‚îÇ - Se√ß√£o "Hist√≥rico de Notifica√ß√µes"                        ‚îÇ
‚îÇ - Timeline de tentativas (sucesso/falha)                    ‚îÇ
‚îÇ - Bot√£o "Reenviar C√≥digos"                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SmsHealthDashboard                                           ‚îÇ
‚îÇ - Widget de sa√∫de do sistema SMS                            ‚îÇ
‚îÇ - M√©tricas em tempo real                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


================================================================================
3. ENDPOINTS DA API BACKEND
================================================================================

3.1 SA√öDE DO SISTEMA SMS
------------------------
GET /api/v1/admin/notifications/sms/health

HEADERS:
  Authorization: Bearer {JWT_TOKEN}

RESPONSE 200 OK:
{
  "healthy": true,
  "consecutiveFailures": 0,
  "totalFailures": 12,
  "totalSuccess": 1543,
  "successRate": 99.22,
  "lastSuccessTimestamp": "2025-12-14T14:35:22Z",
  "lastFailureTimestamp": "2025-12-14T10:15:10Z",
  "lastFailureReason": "Connection timeout"
}


3.2 REENVIAR C√ìDIGOS (ADMIN)
-----------------------------
POST /api/v1/admin/pedidos/{pedidoId}/reenviar-codigos

HEADERS:
  Authorization: Bearer {JWT_TOKEN}
  Content-Type: application/json

PATH PARAMETERS:
  pedidoId: UUID do pedido (ex: 15b81a4f-9c62-4dfe-afb8-adf8c403e3d9)

RESPONSE 200 OK:
{
  "success": true,
  "message": "C√≥digos reenviados com sucesso para o telefone +244 9XX***234."
}

RESPONSE 400 BAD REQUEST (Pedido n√£o PAGO):
{
  "success": false,
  "message": "Pedido n√£o est√° no estado PAID"
}

RESPONSE 404 NOT FOUND:
{
  "success": false,
  "message": "Pedido n√£o encontrado"
}

AUDITORIA:
- Evento registrado: CODIGOS_REENVIADOS_BY_ADMIN
- Entidade: PEDIDO
- EntityId: {pedidoId}
- UserId: {adminUserId}


3.3 DETALHES DO PEDIDO (COM HIST√ìRICO DE NOTIFICA√á√ïES)
-------------------------------------------------------
GET /api/v1/admin/pedidos/{pedidoId}

HEADERS:
  Authorization: Bearer {JWT_TOKEN}

RESPONSE 200 OK:
{
  "id": "15b81a4f-9c62-4dfe-afb8-adf8c403e3d9",
  "referencia": "562113867",
  "estado": "PAID",
  "telefone": "+244 912345678",
  "comprador": {
    "nome": "Jo√£o Silva",
    "email": "joao@example.com"
  },
  "evento": {
    "id": 1,
    "nome": "Festival de Ver√£o 2025",
    "data": "2025-12-20T19:00:00+01:00"
  },
  "bilhetes": [
    {
      "id": 1,
      "codigo": "GDSE-12345678",
      "status": "ATIVO",
      "smsEnviado": true,
      "dataEnvioSms": "2025-12-14T10:30:15+01:00"
    }
  ],
  "notificacoes": [
    {
      "id": 1,
      "tipo": "SMS_TICKET_CODES",
      "status": "SUCCESS",
      "tentativa": 1,
      "dataTentativa": "2025-12-14T10:30:15+01:00",
      "destinatario": "+244 9XX***678",
      "motivo": null
    },
    {
      "id": 2,
      "tipo": "SMS_TICKET_CODES",
      "status": "FAILED",
      "tentativa": 2,
      "dataTentativa": "2025-12-14T11:45:00+01:00",
      "destinatario": "+244 9XX***678",
      "motivo": "Connection timeout"
    }
  ],
  "valorTotal": 5000.00,
  "createdAt": "2025-12-14T10:15:00+01:00",
  "updatedAt": "2025-12-14T11:45:00+01:00"
}


3.4 LISTAR PEDIDOS (COM INDICADOR DE NOTIFICA√á√ïES)
---------------------------------------------------
GET /api/v1/admin/pedidos?page=0&size=20&sort=createdAt,desc

HEADERS:
  Authorization: Bearer {JWT_TOKEN}

QUERY PARAMETERS:
  page: n√∫mero da p√°gina (default: 0)
  size: tamanho da p√°gina (default: 20)
  sort: ordena√ß√£o (ex: createdAt,desc)
  estado: filtro por estado (PENDING, PAID, CANCELLED, EXPIRED)
  notificationStatus: filtro por status de notifica√ß√£o (ALL, FAILED, SUCCESS)

RESPONSE 200 OK:
{
  "content": [
    {
      "id": "15b81a4f-9c62-4dfe-afb8-adf8c403e3d9",
      "referencia": "562113867",
      "estado": "PAID",
      "comprador": "Jo√£o Silva",
      "telefone": "+244 9XX***678",
      "valorTotal": 5000.00,
      "createdAt": "2025-12-14T10:15:00+01:00",
      "hasNotificationFailure": true,
      "lastNotificationStatus": "FAILED",
      "lastNotificationTimestamp": "2025-12-14T11:45:00+01:00",
      "notificationFailureCount": 1
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 20
  },
  "totalElements": 150,
  "totalPages": 8
}


================================================================================
4. MODELO DE DADOS
================================================================================

4.1 EXTENS√ÉO DA ENTIDADE PEDIDO (BACKEND)
------------------------------------------
NOTA: Campos de notifica√ß√£o s√£o calculados dinamicamente a partir da 
      tabela de auditoria ou tabela espec√≠fica de notifica√ß√µes.

N√£o √© necess√°rio adicionar colunas f√≠sicas √† tabela pedidos.
Os dados s√£o agregados via query JOIN.


4.2 NOVA TABELA: notificacoes (RECOMENDADO)
--------------------------------------------
CREATE TABLE notificacoes (
    id BIGSERIAL PRIMARY KEY,
    pedido_id UUID NOT NULL REFERENCES pedidos(id),
    tipo VARCHAR(50) NOT NULL, -- SMS_TICKET_CODES, SMS_PAYMENT_CONFIRMED, EMAIL_CONFIRMATION
    status VARCHAR(20) NOT NULL, -- SUCCESS, FAILED, PENDING
    tentativa INT NOT NULL DEFAULT 1,
    data_tentativa TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    destinatario VARCHAR(255) NOT NULL, -- telefone ou email (mascarado nos logs)
    motivo TEXT, -- raz√£o da falha (timeout, invalid number, etc)
    usuario_id BIGINT REFERENCES usuarios(id), -- admin que solicitou resend
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_notificacoes_pedido_id (pedido_id),
    INDEX idx_notificacoes_status (status),
    INDEX idx_notificacoes_data_tentativa (data_tentativa DESC)
);


4.3 MIGRATION SQL
-----------------
Arquivo: V18__create_notificacoes_table.sql

-- Tabela para rastreamento completo de notifica√ß√µes
CREATE TABLE notificacoes (
    id BIGSERIAL PRIMARY KEY,
    pedido_id UUID NOT NULL REFERENCES pedidos(id) ON DELETE CASCADE,
    tipo VARCHAR(50) NOT NULL CHECK (tipo IN ('SMS_TICKET_CODES', 'SMS_PAYMENT_CONFIRMED', 'EMAIL_CONFIRMATION')),
    status VARCHAR(20) NOT NULL CHECK (status IN ('SUCCESS', 'FAILED', 'PENDING')),
    tentativa INT NOT NULL DEFAULT 1 CHECK (tentativa > 0),
    data_tentativa TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    destinatario VARCHAR(255) NOT NULL,
    motivo TEXT,
    usuario_id BIGINT REFERENCES usuarios(id) ON DELETE SET NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- √çndices para performance
CREATE INDEX idx_notificacoes_pedido_id ON notificacoes(pedido_id);
CREATE INDEX idx_notificacoes_status ON notificacoes(status);
CREATE INDEX idx_notificacoes_data_tentativa ON notificacoes(data_tentativa DESC);
CREATE INDEX idx_notificacoes_tipo_status ON notificacoes(tipo, status);

-- View para agrega√ß√£o r√°pida
CREATE VIEW v_pedidos_notificacoes_summary AS
SELECT 
    p.id AS pedido_id,
    COUNT(CASE WHEN n.status = 'FAILED' THEN 1 END) AS notification_failure_count,
    MAX(CASE WHEN n.status = 'FAILED' THEN n.data_tentativa END) AS last_failure_timestamp,
    MAX(n.data_tentativa) AS last_notification_timestamp,
    (SELECT n2.status FROM notificacoes n2 WHERE n2.pedido_id = p.id ORDER BY n2.data_tentativa DESC LIMIT 1) AS last_notification_status
FROM pedidos p
LEFT JOIN notificacoes n ON n.pedido_id = p.id
GROUP BY p.id;


================================================================================
5. IMPLEMENTA√á√ÉO FRONTEND
================================================================================

5.1 TECNOLOGIAS RECOMENDADAS
-----------------------------
- React 18+ ou Vue 3+
- TypeScript para type safety
- Axios para chamadas HTTP
- TanStack Table (React Table) ou AG Grid para tabela de pedidos
- Tailwind CSS ou Material-UI para estiliza√ß√£o
- React Query ou SWR para cache de dados


5.2 ESTRUTURA DE COMPONENTES
-----------------------------
src/
  components/
    admin/
      pedidos/
        PedidosTable.tsx              # Tabela principal
        PedidoDetailsModal.tsx        # Modal de detalhes
        NotificationHistorySection.tsx # Se√ß√£o de hist√≥rico
        ResendButton.tsx              # Bot√£o de resend
        NotificationStatusBadge.tsx   # Badge de status
      dashboard/
        SmsHealthWidget.tsx           # Widget de sa√∫de SMS
  services/
    api/
      pedidoService.ts               # Servi√ßo de API
      notificationService.ts         # Servi√ßo de notifica√ß√µes
  types/
    pedido.types.ts                  # Tipos TypeScript
    notification.types.ts            # Tipos de notifica√ß√µes
  hooks/
    usePedidos.ts                    # Hook para pedidos
    useNotifications.ts              # Hook para notifica√ß√µes
    useSmsHealth.ts                  # Hook para sa√∫de SMS


5.3 TIPOS TYPESCRIPT
--------------------
// types/notification.types.ts
export interface Notification {
  id: number;
  tipo: NotificationType;
  status: NotificationStatus;
  tentativa: number;
  dataTentativa: string; // ISO 8601
  destinatario: string;
  motivo?: string;
  usuarioId?: number;
}

export type NotificationType = 
  | 'SMS_TICKET_CODES' 
  | 'SMS_PAYMENT_CONFIRMED' 
  | 'EMAIL_CONFIRMATION';

export type NotificationStatus = 'SUCCESS' | 'FAILED' | 'PENDING';

export interface NotificationSummary {
  hasNotificationFailure: boolean;
  lastNotificationStatus: NotificationStatus;
  lastNotificationTimestamp: string;
  notificationFailureCount: number;
}

// types/pedido.types.ts
export interface Pedido {
  id: string;
  referencia: string;
  estado: PedidoEstado;
  comprador: string;
  telefone: string;
  valorTotal: number;
  createdAt: string;
  notificacoes?: Notification[];
  // ... outros campos
}

export interface PedidoWithNotificationStatus extends Pedido, NotificationSummary {}


================================================================================
6. INDICADORES VISUAIS
================================================================================

6.1 CORES PARA ESTADOS DE NOTIFICA√á√ÉO
--------------------------------------
SUCCESS:
  - Background: #10B981 (green-500)
  - Text: #FFFFFF
  - Border: #059669 (green-600)
  - Icon: ‚úì (checkmark)

FAILED:
  - Background: #EF4444 (red-500)
  - Text: #FFFFFF
  - Border: #DC2626 (red-600)
  - Icon: ‚úï (x-mark)

PENDING:
  - Background: #F59E0B (amber-500)
  - Text: #FFFFFF
  - Border: #D97706 (amber-600)
  - Icon: ‚è± (clock)

MULTIPLE_FAILURES (2+ falhas):
  - Background: #DC2626 (red-600)
  - Text: #FFFFFF
  - Border: #991B1B (red-800)
  - Icon: ‚ö† (warning)
  - Animation: Pulse suave


6.2 DESTAQUE NA TABELA DE PEDIDOS
----------------------------------
LINHA NORMAL (sem problemas):
  - Background: #FFFFFF
  - Hover: #F9FAFB (gray-50)

LINHA COM FALHA (hasNotificationFailure = true):
  - Background: #FEF2F2 (red-50)
  - Border-left: 4px solid #EF4444 (red-500)
  - Hover: #FEE2E2 (red-100)

LINHA COM M√öLTIPLAS FALHAS (notificationFailureCount >= 2):
  - Background: #FECACA (red-200)
  - Border-left: 4px solid #DC2626 (red-600)
  - Hover: #FCA5A5 (red-300)
  - Font-weight: 600 (bold)


6.3 EXEMPLO DE C√ìDIGO CSS/TAILWIND
-----------------------------------
// NotificationStatusBadge.tsx
const getNotificationBadgeClass = (status: NotificationStatus, failureCount: number) => {
  if (status === 'FAILED' && failureCount >= 2) {
    return 'bg-red-600 text-white border-red-800 animate-pulse';
  }
  
  switch (status) {
    case 'SUCCESS':
      return 'bg-green-500 text-white border-green-600';
    case 'FAILED':
      return 'bg-red-500 text-white border-red-600';
    case 'PENDING':
      return 'bg-amber-500 text-white border-amber-600';
    default:
      return 'bg-gray-500 text-white border-gray-600';
  }
};

// PedidosTable.tsx
const getRowClass = (pedido: PedidoWithNotificationStatus) => {
  if (pedido.notificationFailureCount >= 2) {
    return 'bg-red-200 border-l-4 border-red-600 hover:bg-red-300 font-semibold';
  }
  
  if (pedido.hasNotificationFailure) {
    return 'bg-red-50 border-l-4 border-red-500 hover:bg-red-100';
  }
  
  return 'bg-white hover:bg-gray-50';
};


================================================================================
7. MODAL DE DETALHES DO PEDIDO
================================================================================

7.1 LAYOUT DO MODAL
-------------------
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ DETALHES DO PEDIDO #562113867                          [X]     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ ‚îÇ INFORMA√á√ïES GERAIS   ‚îÇ  ‚îÇ COMPRADOR            ‚îÇ           ‚îÇ
‚îÇ ‚îÇ Estado: PAID         ‚îÇ  ‚îÇ Nome: Jo√£o Silva     ‚îÇ           ‚îÇ
‚îÇ ‚îÇ Valor: 5.000,00 Kz   ‚îÇ  ‚îÇ Tel: +244 912***678  ‚îÇ           ‚îÇ
‚îÇ ‚îÇ Data: 14/12/2025     ‚îÇ  ‚îÇ Email: joao@...      ‚îÇ           ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ ‚îÇ üì± HIST√ìRICO DE NOTIFICA√á√ïES                       [Reenviar]‚îÇ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ ‚îÇ                                                            ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ ‚úì SMS enviado com sucesso          14/12 10:30:15   ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ   Tentativa #1                                        ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ   Destinat√°rio: +244 9XX***678                       ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ‚îÇ
‚îÇ ‚îÇ                                                            ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ ‚úï Falha ao enviar SMS              14/12 11:45:00   ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ   Tentativa #2                                        ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ   Destinat√°rio: +244 9XX***678                       ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ   Motivo: Connection timeout                         ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îÇ   Solicitado por: admin@arenaticket.com             ‚îÇ  ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ‚îÇ
‚îÇ ‚îÇ                                                            ‚îÇ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ ‚îÇ üé´ BILHETES (2)                                            ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ GDSE-12345678 - Pista - ATIVO                           ‚îÇ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ GDSE-87654321 - VIP - ATIVO                             ‚îÇ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                ‚îÇ
‚îÇ                                    [Fechar]                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


7.2 C√ìDIGO EXEMPLO - NotificationHistorySection.tsx
----------------------------------------------------
import React from 'react';
import { format } from 'date-fns';
import { ptBR } from 'date-fns/locale';
import { CheckCircleIcon, XCircleIcon, ClockIcon } from '@heroicons/react/24/solid';

interface NotificationHistorySectionProps {
  notifications: Notification[];
  onResend: () => void;
  isResending: boolean;
}

export const NotificationHistorySection: React.FC<NotificationHistorySectionProps> = ({
  notifications,
  onResend,
  isResending
}) => {
  const getStatusIcon = (status: NotificationStatus) => {
    switch (status) {
      case 'SUCCESS':
        return <CheckCircleIcon className="w-6 h-6 text-green-500" />;
      case 'FAILED':
        return <XCircleIcon className="w-6 h-6 text-red-500" />;
      case 'PENDING':
        return <ClockIcon className="w-6 h-6 text-amber-500" />;
    }
  };

  const getStatusText = (status: NotificationStatus) => {
    switch (status) {
      case 'SUCCESS':
        return 'SMS enviado com sucesso';
      case 'FAILED':
        return 'Falha ao enviar SMS';
      case 'PENDING':
        return 'Envio pendente';
    }
  };

  const getStatusClass = (status: NotificationStatus) => {
    switch (status) {
      case 'SUCCESS':
        return 'bg-green-50 border-green-200';
      case 'FAILED':
        return 'bg-red-50 border-red-200';
      case 'PENDING':
        return 'bg-amber-50 border-amber-200';
    }
  };

  return (
    <div className="border rounded-lg p-4 bg-gray-50">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-lg font-semibold flex items-center gap-2">
          üì± Hist√≥rico de Notifica√ß√µes
        </h3>
        <button
          onClick={onResend}
          disabled={isResending}
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
        >
          {isResending ? (
            <>
              <span className="animate-spin mr-2">‚è≥</span>
              Reenviando...
            </>
          ) : (
            'Reenviar C√≥digos'
          )}
        </button>
      </div>

      {notifications.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          Nenhuma notifica√ß√£o registrada
        </div>
      ) : (
        <div className="space-y-3">
          {notifications.map((notification) => (
            <div
              key={notification.id}
              className={`border rounded-lg p-4 ${getStatusClass(notification.status)}`}
            >
              <div className="flex items-start gap-3">
                <div className="flex-shrink-0">
                  {getStatusIcon(notification.status)}
                </div>
                <div className="flex-1">
                  <div className="flex items-center justify-between mb-2">
                    <p className="font-semibold text-gray-900">
                      {getStatusText(notification.status)}
                    </p>
                    <span className="text-sm text-gray-600">
                      {format(new Date(notification.dataTentativa), 'dd/MM HH:mm:ss', { locale: ptBR })}
                    </span>
                  </div>
                  
                  <div className="space-y-1 text-sm text-gray-700">
                    <p>Tentativa #{notification.tentativa}</p>
                    <p>Destinat√°rio: {notification.destinatario}</p>
                    
                    {notification.motivo && (
                      <p className="text-red-700 font-medium">
                        Motivo: {notification.motivo}
                      </p>
                    )}
                    
                    {notification.usuarioId && (
                      <p className="text-blue-700">
                        Solicitado por administrador
                      </p>
                    )}
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};


7.3 C√ìDIGO EXEMPLO - PedidoDetailsModal.tsx
--------------------------------------------
import React, { useState } from 'react';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { pedidoService } from '@/services/api/pedidoService';
import { NotificationHistorySection } from './NotificationHistorySection';
import { toast } from 'react-hot-toast';

interface PedidoDetailsModalProps {
  pedido: Pedido;
  isOpen: boolean;
  onClose: () => void;
}

export const PedidoDetailsModal: React.FC<PedidoDetailsModalProps> = ({
  pedido,
  isOpen,
  onClose
}) => {
  const queryClient = useQueryClient();

  const resendMutation = useMutation({
    mutationFn: () => pedidoService.resendTicketCodes(pedido.id),
    onSuccess: (response) => {
      toast.success(response.message);
      queryClient.invalidateQueries(['pedido', pedido.id]);
      queryClient.invalidateQueries(['pedidos']);
    },
    onError: (error: any) => {
      const errorMessage = error.response?.data?.message || 'Erro ao reenviar c√≥digos';
      toast.error(errorMessage);
    }
  });

  const handleResend = () => {
    if (confirm('Deseja realmente reenviar os c√≥digos para este pedido?')) {
      resendMutation.mutate();
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between">
          <h2 className="text-2xl font-bold text-gray-900">
            Detalhes do Pedido #{pedido.referencia}
          </h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 text-2xl"
          >
            √ó
          </button>
        </div>

        {/* Content */}
        <div className="p-6 space-y-6">
          {/* Informa√ß√µes Gerais e Comprador */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {/* ... informa√ß√µes gerais ... */}
          </div>

          {/* Hist√≥rico de Notifica√ß√µes */}
          <NotificationHistorySection
            notifications={pedido.notificacoes || []}
            onResend={handleResend}
            isResending={resendMutation.isPending}
          />

          {/* Bilhetes */}
          <div className="border rounded-lg p-4">
            <h3 className="text-lg font-semibold mb-3">üé´ Bilhetes ({pedido.bilhetes.length})</h3>
            {/* ... lista de bilhetes ... */}
          </div>
        </div>

        {/* Footer */}
        <div className="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-end border-t">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
  );
};


================================================================================
8. SISTEMA DE RESEND
================================================================================

8.1 SERVI√áO DE API (pedidoService.ts)
--------------------------------------
import axios from 'axios';
import { API_BASE_URL } from '@/config';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Interceptor para adicionar token JWT
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('authToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export const pedidoService = {
  /**
   * Reenvia c√≥digos de bilhetes para um pedido
   */
  async resendTicketCodes(pedidoId: string) {
    const { data } = await api.post(`/api/v1/admin/pedidos/${pedidoId}/reenviar-codigos`);
    return data;
  },

  /**
   * Busca detalhes de um pedido incluindo hist√≥rico de notifica√ß√µes
   */
  async getPedidoById(pedidoId: string): Promise<Pedido> {
    const { data } = await api.get(`/api/v1/admin/pedidos/${pedidoId}`);
    return data;
  },

  /**
   * Lista pedidos com filtros e pagina√ß√£o
   */
  async getPedidos(params: {
    page?: number;
    size?: number;
    sort?: string;
    estado?: string;
    notificationStatus?: 'ALL' | 'FAILED' | 'SUCCESS';
  }) {
    const { data } = await api.get('/api/v1/admin/pedidos', { params });
    return data;
  }
};


8.2 HOOK CUSTOMIZADO (usePedidos.ts)
-------------------------------------
import { useQuery } from '@tanstack/react-query';
import { pedidoService } from '@/services/api/pedidoService';

export const usePedidos = (params: {
  page: number;
  size: number;
  notificationStatus?: 'ALL' | 'FAILED' | 'SUCCESS';
}) => {
  return useQuery({
    queryKey: ['pedidos', params],
    queryFn: () => pedidoService.getPedidos(params),
    staleTime: 30000, // 30 segundos
    refetchInterval: 60000, // Refetch a cada 1 minuto
  });
};

export const usePedidoDetails = (pedidoId: string) => {
  return useQuery({
    queryKey: ['pedido', pedidoId],
    queryFn: () => pedidoService.getPedidoById(pedidoId),
    enabled: !!pedidoId,
    staleTime: 10000, // 10 segundos
  });
};


8.3 VALIDA√á√ïES NO FRONTEND
---------------------------
ANTES DE REENVIAR:
‚úì Verificar se pedido est√° no estado PAID
‚úì Verificar se telefone existe
‚úì Verificar se h√° bilhetes associados
‚úì Confirmar a√ß√£o com o usu√°rio (dialog)
‚úì Desabilitar bot√£o durante processamento
‚úì Mostrar feedback visual (loading spinner)

AP√ìS RESEND:
‚úì Mostrar mensagem de sucesso/erro (toast)
‚úì Atualizar hist√≥rico de notifica√ß√µes automaticamente
‚úì Atualizar contadores de falha na tabela
‚úì Registrar log no console (dev mode)


8.4 TRATAMENTO DE ERROS
------------------------
ERROS POSS√çVEIS:
1. Pedido n√£o encontrado (404)
2. Pedido n√£o est√° PAID (400)
3. Telefone inv√°lido ou ausente (400)
4. Falha na API SMS (500)
5. Token expirado (401)
6. Sem permiss√£o (403)

TRATAMENTO:
try {
  await pedidoService.resendTicketCodes(pedidoId);
  toast.success('C√≥digos reenviados com sucesso!');
} catch (error) {
  if (error.response?.status === 404) {
    toast.error('Pedido n√£o encontrado');
  } else if (error.response?.status === 400) {
    toast.error(error.response.data.message || 'Pedido n√£o pode ser reenviado');
  } else if (error.response?.status === 401) {
    toast.error('Sess√£o expirada. Fa√ßa login novamente');
    // Redirecionar para login
  } else {
    toast.error('Erro ao reenviar c√≥digos. Tente novamente.');
  }
}


================================================================================
9. FLUXO DE TRABALHO
================================================================================

9.1 FLUXO NORMAL (SEM PROBLEMAS)
---------------------------------
1. Cliente faz pedido e pagamento
2. Sistema envia SMS com c√≥digos
3. TelcoSmsNotificationProvider.recordSuccess()
4. Registro salvo em notificacoes (status: SUCCESS)
5. Na tabela admin, pedido aparece com linha branca (normal)
6. Modal mostra hist√≥rico com ‚úì verde


9.2 FLUXO COM FALHA (AUTOM√ÅTICO)
---------------------------------
1. Cliente faz pedido e pagamento
2. Sistema tenta enviar SMS
3. Falha (timeout, cr√©ditos esgotados, etc)
4. TelcoSmsNotificationProvider.recordFailure(reason)
5. SmsHealthMonitor incrementa consecutiveFailures
6. Registro salvo em notificacoes (status: FAILED, motivo: reason)
7. Na tabela admin, pedido aparece com linha vermelha (destaque)
8. Se 5 falhas consecutivas ‚Üí alerta nos logs


9.3 FLUXO DE RESEND (MANUAL)
-----------------------------
1. Admin acessa painel e v√™ pedidos com destaque vermelho
2. Admin clica no pedido ‚Üí abre modal de detalhes
3. Modal exibe hist√≥rico de notifica√ß√µes com falha destacada
4. Admin clica em "Reenviar C√≥digos"
5. Sistema valida pedido (PAID, telefone, bilhetes)
6. Sistema tenta enviar SMS novamente
7. Resultado registrado em notificacoes (tentativa #2)
8. Auditoria registra: CODIGOS_REENVIADOS_BY_ADMIN
9. Modal atualiza automaticamente com nova tentativa
10. Se sucesso ‚Üí linha do pedido volta ao normal (branca)
11. Se falha ‚Üí linha permanece vermelha


9.4 FLUXO DE MONITORAMENTO (DASHBOARD)
---------------------------------------
1. Admin acessa widget de sa√∫de SMS no dashboard
2. Widget faz GET /api/v1/admin/notifications/sms/health
3. Exibe m√©tricas em tempo real:
   - Taxa de sucesso: 99.22%
   - Falhas consecutivas: 0
   - Total de falhas hoje: 12
   - √öltima falha: 14/12 10:15 (timeout)
4. Se consecutiveFailures >= 5 ‚Üí badge vermelho piscando
5. Admin clica em "Ver pedidos afetados"
6. Redirecionado para tabela filtrada (notificationStatus=FAILED)


================================================================================
10. CASOS DE USO
================================================================================

CASO DE USO 1: Cr√©ditos SMS Esgotados Durante Evento
-----------------------------------------------------
CEN√ÅRIO:
Durante um evento de alta demanda (500 pedidos/hora), os cr√©ditos SMS 
esgotam √†s 18:30. Entre 18:30 e 19:00, 150 clientes n√£o recebem c√≥digos.

DETEC√á√ÉO:
- 5¬™ falha consecutiva √†s 18:31
- SmsHealthMonitor dispara alerta nos logs
- Widget do dashboard mostra taxa de sucesso caindo para 70%

RESOLU√á√ÉO:
1. Admin v√™ alerta no dashboard
2. Recarrega cr√©ditos SMS
3. Filtra pedidos: notificationStatus=FAILED, data=hoje
4. Identifica 150 pedidos afetados
5. Script ou a√ß√£o em massa: reenviar c√≥digos para todos
6. Sistema reenvia SMS para os 150 pedidos
7. Taxa de sucesso volta para 99%+


CASO DE USO 2: Problema de Conectividade Tempor√°rio
----------------------------------------------------
CEN√ÅRIO:
Servidor SMS do fornecedor fica inst√°vel por 15 minutos (10:00-10:15).
Durante esse per√≠odo, 45 SMS falham com "Connection timeout".

DETEC√á√ÉO:
- 5¬™ falha consecutiva √†s 10:02
- Alerta nos logs: "SMS health critical: 5 consecutive failures"
- √öltima falha registrada: "Connection timeout"

RESOLU√á√ÉO:
1. Admin verifica dashboard e v√™ problema de conectividade
2. Aguarda estabiliza√ß√£o (10:15)
3. Testa sa√∫de do sistema (GET /sms/health)
4. Verifica que healthy=true
5. Filtra pedidos afetados (10:00-10:15, FAILED)
6. Reenvia c√≥digos em lote
7. Todos os 45 pedidos recebem SMS com sucesso


CASO DE USO 3: Cliente Individual N√£o Recebe SMS
-------------------------------------------------
CEN√ÅRIO:
Cliente liga para suporte: "Paguei mas n√£o recebi meus c√≥digos"
Refer√™ncia: 562113867

RESOLU√á√ÉO:
1. Atendente busca pedido no painel (refer√™ncia: 562113867)
2. Linha aparece com destaque vermelho
3. Abre modal de detalhes
4. V√™ hist√≥rico:
   - Tentativa #1: FAILED (10:30) - "Invalid phone number"
   - N√∫mero estava errado: +244 91234567 (faltando d√≠gito)
5. Corrige telefone no sistema
6. Clica "Reenviar C√≥digos"
7. Tentativa #2: SUCCESS (10:35)
8. Cliente recebe SMS imediatamente
9. Linha do pedido volta ao normal


================================================================================
11. CONSIDERA√á√ïES DE SEGURAN√áA
================================================================================

11.1 AUTENTICA√á√ÉO E AUTORIZA√á√ÉO
--------------------------------
‚úì Endpoint de resend requer JWT v√°lido
‚úì Apenas usu√°rios com role ADMIN podem reenviar
‚úì Validar permiss√µes no backend (n√£o confiar apenas no frontend)
‚úì Registrar userId em auditoria para rastreabilidade


11.2 PROTE√á√ÉO DE DADOS SENS√çVEIS
---------------------------------
‚úì Telefones mascarados em logs: +244 9XX***678
‚úì Telefones mascarados na UI (exceto no modal de detalhes)
‚úì N√£o expor dados de cart√£o de cr√©dito
‚úì HTTPS obrigat√≥rio em produ√ß√£o


11.3 RATE LIMITING
-------------------
‚úì Limitar tentativas de resend por pedido: m√°ximo 5/dia
‚úì Limitar tentativas de resend por admin: m√°ximo 100/hora
‚úì Backend deve rejeitar requests abusivos (429 Too Many Requests)


11.4 PREVEN√á√ÉO DE ABUSO
------------------------
‚úì Confirmar a√ß√£o com dialog antes de reenviar
‚úì Desabilitar bot√£o durante processamento
‚úì Cooldown de 1 minuto entre resends do mesmo pedido
‚úì Alertar admin se mesmo pedido for reenviado mais de 3 vezes


================================================================================
12. TESTES E VALIDA√á√ÉO
================================================================================

12.1 TESTES UNIT√ÅRIOS (BACKEND)
--------------------------------
CLASSE: PedidoServiceTest

testReenviarCodigosBilhetes_Success() {
  // Given
  Pedido pedido = criarPedidoPago();
  
  // When
  pedidoService.reenviarCodigosBilhetes(pedido.getId());
  
  // Then
  verify(notificationSender).sendTicketCodesSMS(...);
  verify(smsHealthMonitor).recordSuccess();
  
  Notificacao notificacao = notificacaoRepository.findByPedidoId(pedido.getId()).get(0);
  assertEquals(NotificationStatus.SUCCESS, notificacao.getStatus());
}

testReenviarCodigosBilhetes_PedidoNaoPago_ThrowsException() {
  // Given
  Pedido pedido = criarPedidoPendente();
  
  // When & Then
  assertThrows(BusinessRuleException.class, () -> {
    pedidoService.reenviarCodigosBilhetes(pedido.getId());
  });
}


12.2 TESTES DE INTEGRA√á√ÉO (BACKEND)
------------------------------------
CLASSE: AdminControllerIntegrationTest

testResendEndpoint_Success() {
  // Arrange
  Pedido pedido = criarPedidoPagoNoBanco();
  String token = obterTokenAdmin();
  
  // Act
  ResponseEntity<Map> response = restTemplate.exchange(
    "/api/v1/admin/pedidos/" + pedido.getId() + "/reenviar-codigos",
    HttpMethod.POST,
    new HttpEntity<>(criarHeaders(token)),
    Map.class
  );
  
  // Assert
  assertEquals(HttpStatus.OK, response.getStatusCode());
  assertTrue((Boolean) response.getBody().get("success"));
  
  List<Notificacao> notificacoes = notificacaoRepository.findByPedidoId(pedido.getId());
  assertTrue(notificacoes.size() >= 1);
}


12.3 TESTES E2E (FRONTEND)
---------------------------
TESTE: Reenvio de c√≥digos via modal

describe('PedidoDetailsModal - Resend', () => {
  it('deve reenviar c√≥digos com sucesso', async () => {
    // Arrange
    const pedido = mockPedidoComFalha();
    render(<PedidoDetailsModal pedido={pedido} isOpen={true} />);
    
    // Act
    const resendButton = screen.getByText('Reenviar C√≥digos');
    fireEvent.click(resendButton);
    
    // Confirmar dialog
    const confirmButton = screen.getByText('Confirmar');
    fireEvent.click(confirmButton);
    
    // Assert
    await waitFor(() => {
      expect(screen.getByText('C√≥digos reenviados com sucesso')).toBeInTheDocument();
    });
    
    expect(mockApiService.resendTicketCodes).toHaveBeenCalledWith(pedido.id);
  });
  
  it('deve mostrar erro quando pedido n√£o √© PAID', async () => {
    // Arrange
    mockApiService.resendTicketCodes.mockRejectedValue({
      response: { status: 400, data: { message: 'Pedido n√£o est√° no estado PAID' } }
    });
    
    render(<PedidoDetailsModal pedido={mockPedidoPendente()} isOpen={true} />);
    
    // Act
    fireEvent.click(screen.getByText('Reenviar C√≥digos'));
    fireEvent.click(screen.getByText('Confirmar'));
    
    // Assert
    await waitFor(() => {
      expect(screen.getByText('Pedido n√£o est√° no estado PAID')).toBeInTheDocument();
    });
  });
});


12.4 CHECKLIST DE VALIDA√á√ÉO MANUAL
-----------------------------------
BACKEND:
‚ñ° Endpoint /api/v1/admin/pedidos/{id}/reenviar-codigos responde 200
‚ñ° Endpoint valida que pedido est√° PAID
‚ñ° Endpoint valida que telefone existe
‚ñ° Endpoint registra auditoria corretamente
‚ñ° Notifica√ß√£o √© salva na tabela notificacoes
‚ñ° SmsHealthMonitor √© atualizado corretamente
‚ñ° Logs n√£o exp√µem telefones completos

FRONTEND:
‚ñ° Tabela de pedidos mostra linhas vermelhas para pedidos com falha
‚ñ° Modal abre ao clicar no pedido
‚ñ° Hist√≥rico de notifica√ß√µes √© exibido corretamente
‚ñ° Bot√£o "Reenviar C√≥digos" est√° vis√≠vel e habilitado
‚ñ° Confirmar a√ß√£o antes de reenviar
‚ñ° Bot√£o fica desabilitado durante processamento
‚ñ° Toast de sucesso aparece ap√≥s resend bem-sucedido
‚ñ° Toast de erro aparece em caso de falha
‚ñ° Modal atualiza automaticamente ap√≥s resend
‚ñ° Linha do pedido atualiza na tabela ap√≥s sucesso

INTEGRA√á√ÉO:
‚ñ° Fluxo completo: falha ‚Üí detec√ß√£o ‚Üí resend ‚Üí sucesso
‚ñ° Dashboard de sa√∫de SMS reflete estado correto
‚ñ° M√∫ltiplos resends s√£o registrados corretamente
‚ñ° Filtros de notificationStatus funcionam
‚ñ° Pagina√ß√£o funciona com pedidos problem√°ticos


================================================================================
CHECKLIST DE IMPLEMENTA√á√ÉO
================================================================================

BACKEND:
‚ñ° Criar tabela notificacoes (migration V18)
‚ñ° Criar entidade Notificacao.java
‚ñ° Criar repository NotificacaoRepository.java
‚ñ° Modificar TelcoSmsNotificationProvider para salvar em notificacoes
‚ñ° Modificar PedidoService.reenviarCodigosBilhetes para salvar tentativa
‚ñ° Adicionar campo notificacoes em PedidoDTO
‚ñ° Adicionar filtro notificationStatus em PedidoRepository
‚ñ° Criar endpoint GET /api/v1/admin/pedidos/{id}/notificacoes
‚ñ° Testar endpoints com Postman/Insomnia
‚ñ° Validar logs e auditoria

FRONTEND:
‚ñ° Criar tipos TypeScript (notification.types.ts)
‚ñ° Criar pedidoService.ts com m√©todos de API
‚ñ° Criar hook usePedidos com filtro de notifica√ß√µes
‚ñ° Criar componente NotificationStatusBadge
‚ñ° Criar componente NotificationHistorySection
‚ñ° Modificar PedidosTable para destacar linhas problem√°ticas
‚ñ° Modificar PedidoDetailsModal para incluir hist√≥rico
‚ñ° Criar componente ResendButton
‚ñ° Implementar tratamento de erros
‚ñ° Adicionar testes unit√°rios
‚ñ° Adicionar testes E2E

DASHBOARD:
‚ñ° Criar widget SmsHealthWidget
‚ñ° Integrar com endpoint /api/v1/admin/notifications/sms/health
‚ñ° Adicionar alertas visuais para consecutiveFailures >= 5
‚ñ° Criar link para filtrar pedidos com falha

DOCUMENTA√á√ÉO:
‚ñ° Atualizar README do projeto
‚ñ° Documentar endpoints na API docs
‚ñ° Criar guia de uso para equipe de suporte
‚ñ° Criar runbook para recupera√ß√£o de falhas em massa


================================================================================
SUPORTE E MANUTEN√á√ÉO
================================================================================

LOGS IMPORTANTES:
- /var/log/arenaticket/application.log (SMS attempts)
- /var/log/arenaticket/audit.log (Resend operations)
- Dashboard Grafana: m√©tricas de SMS

COMANDOS √öTEIS:
# Ver logs de SMS em tempo real
tail -f /var/log/arenaticket/application.log | grep "SMS"

# Contar falhas de hoje
grep "SMS.*FAILED" /var/log/arenaticket/application.log | grep "2025-12-14" | wc -l

# Ver √∫ltimos 50 resends
grep "CODIGOS_REENVIADOS_BY_ADMIN" /var/log/arenaticket/audit.log | tail -50

CONTATOS:
- Suporte TelcoSMS: suporte@telcosms.ao
- Equipe Backend: backend@arenaticket.com
- Equipe Frontend: frontend@arenaticket.com


================================================================================
FIM DO GUIA
================================================================================

Este documento fornece todas as diretrizes t√©cnicas necess√°rias para
implementar o sistema de resend e rastreamento de notifica√ß√µes no painel
administrativo do ArenaTicket.

Para d√∫vidas ou sugest√µes, contate a equipe de arquitetura.

Vers√£o: 1.0
Data: 14 de dezembro de 2025
